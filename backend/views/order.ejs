<%- include('layout/header') %>

<link rel="stylesheet" href="/css/style.css" />

<main class="order-confirmation-container animate-fadeIn">
  <% if (typeof orders !== 'undefined' && Array.isArray(orders)) { %>
    <h1>Your Orders</h1>
    <% if (orders.length === 0) { %>
      <p>No orders found.</p>
    <% } else { %>
      <% orders.forEach(order => { %>
        <section class="order-summary">
          <p>Thank you for your order, <strong><%= order.userId.name %></strong>!</p>
          <p><strong>Order ID:</strong> <%= order._id %></p>
          <p><strong>Payment Method:</strong> <%= order.paymentMethod %></p>
          <p><strong>Payment Status:</strong> <%= order.paymentStatus %></p>
          <p><strong>Order Date:</strong> <%= order.createdAt.toDateString() %></p>
        </section>
        <section class="order-items">
          <h2>Items Ordered</h2>
          <% order.items.forEach(item => { %>
            <div class="order-item">
              <h3><%= item.productId ? item.productId.name : 'Product removed' %></h3>
              <p>Quantity: <%= item.quantity %></p>
              <p>Price per item: ₹<%= (item.productId && typeof item.productId.price === 'number') ? item.productId.price.toFixed(2) : '0.00' %></p>
              <p>Subtotal: ₹<%= (item.productId && typeof item.productId.price === 'number') ? (item.quantity * item.productId.price).toFixed(2) : '0.00' %></p>
            </div>
          <% }) %>
        </section>
        <section class="order-total">
          <h3>Total Price: ₹<%= order.totalPrice.toFixed(2) %></h3>
        </section>
        <hr>
      <% }) %>
    <% } %>
    <a href="/" class="btn btn-primary">Back to Home</a>
  <% } else if (typeof order !== 'undefined') { %>
    <h1>Order Confirmation</h1>
    <section class="order-summary">
      <p>Thank you for your order, <strong><%= order.userId.name %></strong>!</p>
      <p><strong>Order ID:</strong> <%= order._id %></p>
      <p><strong>Payment Method:</strong> <%= order.paymentMethod %></p>
      <p><strong>Payment Status:</strong> <%= order.paymentStatus %></p>
      <p><strong>Order Date:</strong> <%= order.createdAt.toDateString() %></p>
    </section>
    <section class="order-items">
      <h2>Items Ordered</h2>
      <% order.items.forEach(item => { %>
        <div class="order-item">
          <h3><%= item.productId ? item.productId.name : 'Product removed' %></h3>
          <p>Quantity: <%= item.quantity %></p>
          <p>Price per item: ₹<%= (item.productId && typeof item.productId.price === 'number') ? item.productId.price.toFixed(2) : '0.00' %></p>
          <p>Subtotal: ₹<%= (item.productId && typeof item.productId.price === 'number') ? (item.quantity * item.productId.price).toFixed(2) : '0.00' %></p>
        </div>
      <% }) %>
    </section>
    <section class="order-total">
      <h3>Total Price: ₹<%= order.totalPrice.toFixed(2) %></h3>
    </section>
    <a href="/" class="btn btn-primary">Back to Home</a>
  <% } %>
</main>

<!-- Styles moved to style.css -->
<%- include('layout/footer') %>