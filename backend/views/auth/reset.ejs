<!DOCTYPE html>
<html>
<head>
  <title>Reset Password - DailyShop</title>
  <link rel="stylesheet" href="/css/style.css" />
</head>
<body>
  <%- include('../layout/header') %>
  <main class="container" style="padding:48px;display:flex;justify-content:center;">
    <div style="max-width:520px;background:#fff;padding:28px;border-radius:10px;box-shadow:0 12px 40px rgba(2,6,23,0.06);">
      <h2>Reset Password</h2>
      <% if (error) { %>
        <div style="color:#ef4444;margin:10px 0;"><%= error %></div>
      <% } %>
      <form id="resetForm" action="/auth/reset/<%= token %>" method="POST">
        <label>New Password</label>
        <input id="password" type="password" name="password" required style="width:100%;padding:10px;border-radius:6px;border:1px solid #e6e9ef;margin-top:6px;" />
        <div id="strength" style="margin-top:8px;height:8px;border-radius:6px;background:#f1f5f9;"></div>
        <small id="strengthText" style="display:block;color:#6b7280;margin-top:6px;">Password strength: </small>

        <label style="margin-top:10px;">Confirm Password</label>
        <input id="confirm" type="password" name="confirm" required style="width:100%;padding:10px;border-radius:6px;border:1px solid #e6e9ef;margin-top:6px;" />

        <div style="margin-top:12px;text-align:right;"><button id="submitBtn" type="submit" style="padding:10px 16px;border-radius:8px;background:#10b981;color:#fff;border:none;">Set Password</button></div>
      </form>
      <script>
        (function(){
          const pw = document.getElementById('password');
          const confirm = document.getElementById('confirm');
          const strength = document.getElementById('strength');
          const strengthText = document.getElementById('strengthText');
          const form = document.getElementById('resetForm');

          function scorePassword(p){
            let score = 0;
            if (!p) return score;
            // length
            if (p.length >= 8) score += 1;
            if (p.length >= 12) score += 1;
            // variety
            if (/[A-Z]/.test(p)) score += 1;
            if (/[0-9]/.test(p)) score += 1;
            if (/[^A-Za-z0-9]/.test(p)) score += 1;
            return score; // 0-5
          }

          function refresh(){
            const s = scorePassword(pw.value);
            const pct = (s/5)*100;
            strength.style.width = pct + '%';
            let color = '#ef4444';
            let txt = 'Very weak';
            if (s >= 4){ color = '#10b981'; txt = 'Strong'; }
            else if (s >= 2){ color = '#f59e0b'; txt = 'Medium'; }
            strength.style.background = color;
            strengthText.textContent = 'Password strength: ' + txt;
          }

          pw.addEventListener('input', refresh);

          form.addEventListener('submit', function(e){
            if (pw.value !== confirm.value){
              e.preventDefault();
              alert('Passwords do not match');
              return false;
            }
            if (scorePassword(pw.value) < 2){
              if (!confirm('Password looks weak. Are you sure you want to continue?')){
                e.preventDefault();
                return false;
              }
            }
          });
        })();
      </script>
    </div>
  </main>
  <%- include('../layout/footer') %>
</body>
</html>